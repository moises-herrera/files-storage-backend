import{b as ee,e as te,f as ie,h as re,i as oe,j as ne,o as le,p as ae,q as se,r as me,s as pe,t as ce,u as de,v as fe}from"./chunk-JJUW2ZSY.js";import"./chunk-BQZTRGT6.js";import{g as X,h as I,k as M}from"./chunk-TRTNSBED.js";import{a as Z}from"./chunk-QZ54JNXH.js";import"./chunk-42LHFYUJ.js";import{Ea as _,pa as Y}from"./chunk-5OWMNN74.js";import{$ as m,D as F,Db as U,Eb as A,Ib as O,Jc as C,Kc as Q,Lc as E,Pb as H,Qb as n,Rb as b,Sa as l,Sb as x,Tb as j,Ub as G,Vb as z,Wb as W,Yb as q,Zb as S,a as k,bb as u,d as B,fa as R,fc as f,ga as N,gb as V,gc as v,hc as J,ic as P,n as h,ob as s,rc as K,ua as y,vb as $,wb as L,xb as i,yb as r,zb as p}from"./chunk-CLJZXXJK.js";var ye=o=>["/storage",o],be=(o,t)=>t.id;function xe(o,t){if(o&1&&(i(0,"div",3)(1,"p"),p(2,"span",4),r(),i(3,"p",5),n(4),r()()),o&2){let e=t.$implicit;s("routerLink",S(3,ye,e.id)),l(3),s("title",e.name),l(),x(" ",e.name," ")}}var D=class o{folderService=m(ee);alertService=m(_);recentFolders$=y(this.folderService.getRecentFolders().pipe(F(()=>(this.alertService.displayError("Error al cargar las carpetas recientes"),h([])))));static \u0275fac=function(e){return new(e||o)};static \u0275cmp=u({type:o,selectors:[["app-folders-grid"]],decls:7,vars:2,consts:[[1,"flex","flex-col","gap-4"],[1,"text-lg","font-medium"],[1,"flex","items-center","flex-wrap","gap-4"],[1,"h-[56px]","w-[250px]","flex","items-center","gap-x-2","bg-surface-50","border","border-surface-200","rounded-lg","px-4","hover:bg-surface-200","transition-colors","duration-200",3,"routerLink"],[1,"pi","pi-folder"],[1,"truncate",3,"title"]],template:function(e,a){e&1&&(i(0,"section",0)(1,"h2",1),n(2,"Carpetas recientes"),r(),i(3,"div",2),$(4,xe,5,5,"div",3,be),f(6,"async"),r()()),e&2&&(l(4),L(v(6,0,a.recentFolders$())))},dependencies:[E,C,M,I],encapsulation:2})};var Fe=()=>[],Se=o=>["/storage",o];function Ce(o,t){o&1&&(i(0,"tr")(1,"th",9),n(2,"Nombre"),r(),i(3,"th",10),n(4,"Propietario"),r(),i(5,"th",10),n(6,"\xDAltima modificaci\xF3n"),r(),i(7,"th",11),n(8,"Tipo"),r(),i(9,"th",11),n(10,"Tama\xF1o"),r(),i(11,"th",10),n(12,"Carpeta"),r()())}function Ee(o,t){if(o&1&&(i(0,"tr",12)(1,"td")(2,"p",13),p(3,"span",14),i(4,"span",15),n(5),r()()(),i(6,"td"),n(7),r(),i(8,"td"),n(9),f(10,"date"),r(),i(11,"td")(12,"span"),n(13),f(14,"fileType"),r()(),i(15,"td"),n(16),f(17,"fileSize"),r(),i(18,"td")(19,"p",16),p(20,"span",17),i(21,"a",18),n(22),r()()()()),o&2){let e=t.$implicit;s("pContextMenuRow",e),l(5),x(" ",e.name," "),l(2),b(e.owner.email),l(2),x(" ",J(10,8,e.updatedAt,"dd/MM/yyyy HH:mm:ss")," "),l(4),b(v(14,11,e.extension)),l(3),b(v(17,13,e.size)),l(5),s("routerLink",S(15,Se,e.folder.id)),l(),b(e.folder.name)}}var w=class o{fileService=m(me);alertService=m(_);router=m(X);recentFiles$=y(h([]));selectedItem=null;isFileDialogVisible=y(!1);settingsMenuItems=[{label:"Descargar",icon:"pi pi-download",command:()=>{this.selectedItem&&this.downloadFile(this.selectedItem)}},{label:"Renombrar",icon:"pi pi-pencil",command:()=>{this.isFileDialogVisible.set(!0)}},{label:"Eliminar",icon:"pi pi-trash",command:()=>{let t=k({},this.selectedItem);t&&this.handleItemDelete(t)}}];ngOnInit(){this.getRecentFiles()}getRecentFiles(){this.recentFiles$.set(this.fileService.getRecentFiles().pipe(F(()=>(this.alertService.displayError("Error al cargar los archivos recientes"),h([])))))}goToFolder(t){this.router.navigateByUrl(`/storage/${t}`)}downloadFile(t){this.alertService.displayMessage({severity:"info",summary:"Descargando archivo...",detail:`Descargando ${t.name}`,sticky:!0}),this.fileService.getFileUrl(t.id).subscribe({next:a=>B(this,[a],function*({url:e}){try{let d=yield ce.getBlobFileFromUrl(e),c=document.createElement("a");c.style.display="none",c.href=d,c.download=t.name,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(d),this.alertService.clearMessages()}catch{this.alertService.clearMessages(),this.alertService.displayError("Error al descargar el archivo")}}),error:()=>{this.alertService.clearMessages(),this.alertService.displayError("Error al descargar el archivo")}})}handleItemDelete(t){this.alertService.displayConfirm({header:"Eliminar archivo",message:`\xBFEst\xE1 seguro de que desea eliminar ${t.name}?`,accept:()=>{this.deleteFiles([t.id||""])},acceptButtonProps:{label:"Eliminar",severity:"danger"},rejectButtonProps:{label:"Cancelar",severity:"secondary",outlined:!0}})}deleteFiles(t){this.fileService.deleteFiles(t).subscribe({next:()=>{this.alertService.displaySuccess("Archivos eliminados correctamente"),this.getRecentFiles()},error:()=>{this.alertService.displayError("Error al eliminar los archivos")}})}closeDialog(t=!1){this.isFileDialogVisible.set(!1),t&&this.getRecentFiles()}static \u0275fac=function(e){return new(e||o)};static \u0275cmp=u({type:o,selectors:[["app-files-table"]],decls:13,vars:9,consts:[["contextMenu",""],["header",""],["body",""],[1,"flex","flex-col","gap-1"],[1,"text-lg","font-medium"],[3,"model"],["styleClass","w-full h-full",3,"contextMenuSelectionChange","value","contextMenuSelection","contextMenu"],[3,"closeDialog","isDialogVisible","folderItemData"],["styleClass","confirm-dialog"],[1,"w-4/12"],[1,"w-2/12"],[1,"w-1/12"],[1,"hover:bg-zinc-50",3,"pContextMenuRow"],[1,"w-full","flex","items-center","gap-2"],[1,"pi","pi-file"],[1,"w-[180px]","xl:w-[22vw]","truncate"],[1,"flex","items-center","gap-2","w-[250px]","truncate"],[1,"pi","pi-folder"],[1,"text-primary-800","hover:underline",3,"routerLink"]],template:function(e,a){if(e&1){let d=U();i(0,"section",3)(1,"h2",4),n(2,"Archivos recientes"),r(),p(3,"p-contextmenu",5,0),i(5,"p-table",6),f(6,"async"),W("contextMenuSelectionChange",function(g){return R(d),z(a.selectedItem,g)||(a.selectedItem=g),N(g)}),V(7,Ce,13,0,"ng-template",null,1,P)(9,Ee,23,17,"ng-template",null,2,P),r()(),i(11,"app-file-item-dialog",7),A("closeDialog",function(g){return R(d),N(a.closeDialog(g))}),r(),p(12,"p-confirmdialog",8)}if(e&2){let d=H(4);l(3),s("model",a.settingsMenuItems),l(2),s("value",v(6,6,a.recentFiles$())||q(8,Fe)),G("contextMenuSelection",a.selectedItem),s("contextMenu",d),l(6),s("isDialogVisible",a.isFileDialogVisible())("folderItemData",a.selectedItem)}},dependencies:[E,C,Q,M,I,se,le,ae,ne,oe,de,re,ie,te,pe,fe],encapsulation:2})};var T=class o{userService=m(Z);user=K(()=>this.userService.user());static \u0275fac=function(e){return new(e||o)};static \u0275cmp=u({type:o,selectors:[["app-home"]],decls:7,vars:5,consts:[[1,"section-container","gap-y-6"],[1,"section-title","mb-0!","truncate"],[3,"title"]],template:function(e,a){e&1&&(i(0,"section",0)(1,"h1",1),n(2," Bienvenido, "),i(3,"span",2),n(4),r()(),p(5,"app-folders-grid")(6,"app-files-table"),r()),e&2&&(l(3),O("title","",a.user().firstName," ",a.user().lastName,""),l(),j("",a.user().firstName," ",a.user().lastName,""))},dependencies:[D,w],encapsulation:2})};var pt=[{path:"",title:`${Y.appName} - Inicio`,component:T}];export{pt as homeRoutes};
