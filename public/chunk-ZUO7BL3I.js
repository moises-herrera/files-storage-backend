import{Ja as q,Ka as z}from"./chunk-TOJFIFPL.js";import{B as d,C as w,Gb as V,J as R,Jc as W,Mc as Y,Q as b,R as T,Rb as B,S as g,Sb as U,T as A,Ta as I,X as F,Ya as e,Z as D,_a as p,a as y,aa as c,b as x,cb as _,db as j,eb as E,hb as $,j as f,l as n,mc as G,nc as K,pb as N,rb as P,s as O,ua as l,ub as S,yb as k,z as C,zb as L}from"./chunk-FYW5SQEH.js";function rr(r,M){if(r&1&&(k(0,"label",2),B(1),L()),r&2){let t=V();P("hide-control",t.hideError),I(),U(t.errorText)}}function tr(r,M){}function or(r,M){r&1&&$(0,tr,0,0,"ng-template")}var sr=(()=>{class r{constructor(){this.vcr=c(p)}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275dir=E({type:r,selectors:[["","controlErrorAnchor",""]],exportAs:["controlErrorAnchor"]})}}return r})(),J=(()=>{class r{constructor(){this.errorText=null,this.hideError=!0,this.cdr=c(K),this.host=c(l),this._addClasses=[]}createTemplate(t,o,s){this.errorTemplate=t,this.errorContext={$implicit:o,text:s},this.cdr.markForCheck()}set customClass(t){this.hideError||(this._addClasses=Array.isArray(t)?t:t.split(/\s/),this.host.nativeElement.classList.add(...this._addClasses))}set text(t){t!==this.errorText&&(this.errorText=t,this.hideError=!t,this.hideError&&this.host.nativeElement.classList.remove(...this._addClasses),this.cdr.markForCheck())}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275cmp=_({type:r,selectors:[["control-error"]],decls:2,vars:3,consts:[[1,"control-error",3,"hide-control"],[4,"ngTemplateOutlet","ngTemplateOutletContext"],[1,"control-error"]],template:function(o,s){o&1&&$(0,rr,2,3,"label",0)(1,or,1,0,null,1),o&2&&(S(s.errorTemplate?-1:0),I(),N("ngTemplateOutlet",s.errorTemplate)("ngTemplateOutletContext",s.errorContext))},dependencies:[Y,W],styles:[".hide-control[_ngcontent-%COMP%]{display:none!important}[_nghost-%COMP%]{display:block}"],changeDetection:0})}}return r})(),Q=new D("FORM_ERRORS",{providedIn:"root",factory:()=>({})}),X=new D("ErrorTailorConfigProvider");function yr(r){return[{provide:X,useValue:r},y({provide:Q},r.errors)]}var er=(()=>{class r{constructor(){this.submit=new f,this.destroy=new f,this.host=c(l),this.element=this.host.nativeElement,this.submit$=this.submit.asObservable(),this.reset$=C(this.element,"reset").pipe(A(()=>this.submit.next(null)))}ngOnInit(){C(this.element,"submit").pipe(g(this.destroy)).subscribe(this.submit)}static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275dir=E({type:r,selectors:[["form","errorTailor",""]]})}}return r})(),H="error-tailor-has-error",Or=(()=>{class r{constructor(t,o,s,i,h,a,m,u){this.vcr=t,this.config=s,this.globalErrors=i,this.controlErrorAnchorParent=h,this.form=a,this.ngControl=m,this.controlContainer=u,this.customErrors={},this.destroy=new f,this.mergedConfig={},this.host=o.nativeElement,this.submit$=this.form?this.form.submit$:n,this.reset$=this.form?this.form.reset$:n}ngOnInit(){this.mergedConfig=this.buildConfig(),this.control=(this.controlContainer||this.ngControl).control;let t=!!this.control.asyncValidator,o=this.control.statusChanges.pipe(R()),s=this.control.valueChanges,i=d(o,s),h=n,a=n,m=n,u=n;(!this.controlErrorsClass||this.controlErrorsClass?.length===0)&&this.mergedConfig.controlErrorsClass&&this.mergedConfig.controlErrorsClass&&(this.controlErrorsClass=this.mergedConfig.controlErrorsClass),(!this.controlCustomClass||this.controlCustomClass?.length===0)&&this.mergedConfig.controlCustomClass&&this.mergedConfig.controlCustomClass&&(this.controlCustomClass=this.mergedConfig.controlCustomClass),this.mergedConfig.controlErrorsOn.async&&t&&(h=o),this.isInput&&this.mergedConfig.controlErrorsOn.change&&(m=s),this.mergedConfig.controlErrorsOn.status&&(u=o),this.isInput&&this.mergedConfig.controlErrorsOn.blur&&(a=C(this.host,"focusout").pipe(T(()=>s.pipe(b(!0)))));let Z=d(this.submit$.pipe(O(()=>!0)),this.reset$.pipe(O(()=>!1),A(()=>this.hideError()))).pipe(T(v=>v?i.pipe(b(!0)):w));this.reset$.pipe(g(this.destroy)).subscribe(()=>this.clearRefs()),d(h,a,m,Z,u).pipe(g(this.destroy)).subscribe(()=>{!!this.control.errors?this.showError():this.hideError()})}setError(t,o){if(this.mergedConfig.controlClassOnly)return;this.ref??=this.resolveAnchor().createComponent(this.mergedConfig.controlErrorComponent);let s=this.ref.instance;this.controlErrorsTpl?s.createTemplate(this.controlErrorsTpl,o,t):s.text=t,this.controlErrorsClass&&(s.customClass=this.controlErrorsClass),!this.controlErrorAnchor&&this.mergedConfig.controlErrorComponentAnchorFn&&(this.customAnchorDestroyFn=this.mergedConfig.controlErrorComponentAnchorFn(this.host,this.ref.hostView.rootNodes[0]))}showError(){let t=this.control.errors;if(t){let[o]=Object.keys(t),s=this.customErrors[o]||this.globalErrors[o];if(!s){G()&&console.warn(`[@ngneat/error-tailor]: Missing error message for ${o}`);return}let i=typeof s=="function"?s(t[o]):s;this.addCustomClass(),this.setError(i,t)}}hideError(){this.removeCustomClass(),this.ref&&this.setError(null)}ngOnDestroy(){this.destroy.next(),this.clearRefs()}get customClasses(){return Array.isArray(this.controlCustomClass)?this.controlCustomClass:this.controlCustomClass?.split(/\s/)??[]}get isInput(){return this.mergedConfig.blurPredicate(this.host)}clearRefs(){this.customAnchorDestroyFn&&(this.customAnchorDestroyFn(),this.customAnchorDestroyFn=null),this.ref?.destroy(),this.ref=null}resolveAnchor(){return this.controlErrorAnchor?this.controlErrorAnchor.vcr:this.controlErrorAnchorParent?this.controlErrorAnchorParent.vcr:this.vcr}buildConfig(){return x(y({blurPredicate(t){return t.tagName==="INPUT"||t.tagName==="SELECT"},controlErrorComponent:J},this.config),{controlErrorsOn:{async:this.controlErrorsOnAsync??this.config.controlErrorsOn?.async??!0,blur:this.controlErrorsOnBlur??this.config.controlErrorsOn?.blur??!0,change:this.controlErrorsOnChange??this.config.controlErrorsOn?.change??!1,status:this.controlErrorsOnStatusChange??this.config.controlErrorsOn?.status??!1}})}addCustomClass(){this.isInput&&(this.host.parentElement.classList.add(H),this.controlCustomClass&&this.host.classList.add(...this.customClasses))}removeCustomClass(){this.isInput&&(this.host.parentElement.classList.remove(H),this.controlCustomClass&&this.host.classList.remove(...this.customClasses))}static{this.\u0275fac=function(o){return new(o||r)(e(p),e(l),e(X),e(Q),e(sr,8),e(er,8),e(z,10),e(q,10))}}static{this.\u0275dir=E({type:r,selectors:[["","formControlName","",3,"controlErrorsIgnore",""],["","formControl","",3,"controlErrorsIgnore",""],["","formGroup","",3,"controlErrorsIgnore",""],["","formGroupName","",3,"controlErrorsIgnore",""],["","formArrayName","",3,"controlErrorsIgnore",""],["","ngModel","",3,"controlErrorsIgnore",""]],inputs:{customErrors:[0,"controlErrors","customErrors"],controlErrorsClass:"controlErrorsClass",controlCustomClass:"controlCustomClass",controlErrorsTpl:"controlErrorsTpl",controlErrorsOnAsync:"controlErrorsOnAsync",controlErrorsOnBlur:"controlErrorsOnBlur",controlErrorsOnChange:"controlErrorsOnChange",controlErrorsOnStatusChange:"controlErrorsOnStatusChange",controlErrorAnchor:"controlErrorAnchor"},exportAs:["errorTailor"]})}}return r})();var br=(()=>{class r{static{this.\u0275fac=function(o){return new(o||r)}}static{this.\u0275mod=j({type:r})}static{this.\u0275inj=F({imports:[J]})}}return r})();export{yr as a,Or as b,br as c};
